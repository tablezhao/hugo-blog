---
title: "诊所网站迁移手记"
date: 2017-07-26T18:30:00+08:00
tags: ['极客']
featured: true
---

<!--more-->


## 缘由

15年时，刚进入法律诊所学习，和诊所老师聊得很投机，就答应帮忙建一个诊所网站，不承想这个网站从15年已经运行了两年多了，还屹立于这个世界上，我很是欣慰。但随着国内网络环境的恶化，加之服务费启高，以及我毕业离开诊所之后无人维护网站等等原因，我决定把诊所网站从原来的虚拟主机迁出，迁入到位于洛杉矶的VPS中，这样节约成本，也更方便我自己管理。

## 迁出

诊所网站原本是在国内一家小运营商的虚拟主机上，所以迁出的工作主要就是在后台打包数据库并下载到本地，以及通过FTP把网站后台的一些自定义数据下载到本地。

迁出的过程还是比较顺利的，主要是这个虚拟主机的源在河南，所以数据拖回本地的速度很快。

## 迁入

将网站迁入到位于洛杉矶的VPS时我遇到了几个问题。

第一个问题是导入SQL数据时遇到的错误提示，即提示有一张数据表无法导入。一开始我以为是数据损坏了，但我重新检查了数据导出过程并没有什么错误。通过Google检索我也没发现原因，只能自己摸索。我重新导出，在导出时把所有可选项都勾选了，这样导出的文件在导入时就没有再报错了。

另一个问题是CMS程序安装时与数据库对接的问题。因为诊所网站使用了蝉知CMS，在安装时需要填入数据库名和密码信息，但如果填入的信息与之前的数据库完全相同则会提示已存在数据库，需要抹除数据。所以为了保证数据安全，可以新建一个数据库，并将CMS与其对接，对接成功后再把原来的数据导入新数据库，这样数据就能完全恢复。

第三个问题是域名解析的问题。在迁入网站后，我把域名从原来的虚拟主机解析到我的VPS上，解析挺顺利，一会儿就可以打开网站了。但是过一会儿我再访问网站时会提示 “Bad request （Invalid hostname）”，我觉得很奇怪，以为是nignx的问题，于是重启nignx，可是这个错误提示还是反复出现。经过Google之后，发现这个提示一般是windows IIS服务的提示，然而我的VPS是Linux系统，怎么会出现这样的提示呢？思考之后，我觉得是DNS解析存在时效的问题，也就是部分地区仍解析到原虚拟主机上，这样因为原虚拟主机被我关闭了，所以就会提示错误。果然在等了一天以后，这样的提示不再出现。

## 一点感想

诊所网站迁出成功之后，我回想了这几年折腾网站的经历。

其实最早是在高中用Frontpage做静态站玩，那个时候几乎就和做PPT一样，这个网站后来放在高中官网上，后来也时不时地去看看，前段时间我再去看，发现已经404了，可能是现在维护高中官网的老师移除这个网页。现在再去找这个网页的文件，可能只有到我那台快作古的台式机里才能找到了吧。

诊所网站则是我第二次尝试，主要使用了CMS建站程序，不再自己一个控件一个控件的搭了。经过接近一年的打磨，网站看上去还是像点样子的。这次迁出来的目的，其实就是因为舍不得这个网站也就这么没了。

最近自己在做的网站是法律尽职调查导航网站，这次有了自己的团队，在前端工程师和设计师的帮助下完成了网站，尽管还很稚嫩，但总算不是孤芳自赏，有一些人会去使用我的网站了，这一点让我很高兴。

最后，还是放一下诊所网站的地址——[www.jsflyz.com](http://www.jsflyz.com)

2017/07/26
